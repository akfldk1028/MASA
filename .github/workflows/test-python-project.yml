name: "ğŸ Python Project Builder Test"
on:
  push:
    branches: [main]
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

jobs:
  create-python-app:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: ğŸš€ Create Python Weather App
        id: claude-python
        uses: ./
        with:
          prompt: |
            Pythonìœ¼ë¡œ ë‚ ì”¨ ì•± ë§Œë“¤ì–´ì¤˜:
            
            1. weather_app.py - ë©”ì¸ íŒŒì¼
               - OpenWeatherMap API ì‚¬ìš© (requests ë¼ì´ë¸ŒëŸ¬ë¦¬)
               - ë„ì‹œ ì´ë¦„ ì…ë ¥ë°›ì•„ì„œ ë‚ ì”¨ ì •ë³´ ì¶œë ¥
               - ì˜¨ë„, ìŠµë„, ë‚ ì”¨ ìƒíƒœ í‘œì‹œ
               - ì—ëŸ¬ ì²˜ë¦¬ í¬í•¨
            
            2. requirements.txt
               - í•„ìš”í•œ íŒ¨í‚¤ì§€ë“¤
            
            3. README.md
               - í”„ë¡œì íŠ¸ ì„¤ëª…
               - ì„¤ì¹˜ ë°©ë²•
               - ì‚¬ìš© ë°©ë²•
               - API í‚¤ ì„¤ì • ê°€ì´ë“œ
            
            4. .env.example
               - API í‚¤ í…œí”Œë¦¿
            
            5. test_weather.py
               - ê°„ë‹¨í•œ ìœ ë‹› í…ŒìŠ¤íŠ¸
               
            ëª¨ë“  íŒŒì¼ì„ python-weather-app/ í´ë”ì— ìƒì„±í•´ì¤˜.
            ì½”ë“œëŠ” ê¹”ë”í•˜ê³  ì£¼ì„ í¬í•¨í•´ì„œ ì‘ì„±í•´ì¤˜.
            
          allowed_tools: "Write,Read,Edit"
          timeout_minutes: "10"
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          
      - name: ğŸ“ Check created files
        run: |
          echo "=== Created Python Project Files ==="
          find python-weather-app -type f -name "*.py" -o -name "*.txt" -o -name "*.md" | sort
          echo ""
          echo "=== Project Structure ==="
          tree python-weather-app || ls -la python-weather-app/
          
      - name: ğŸ§ª Test Python installation
        run: |
          cd python-weather-app
          echo "=== Installing dependencies ==="
          python -m pip install -r requirements.txt
          
          echo ""
          echo "=== Running tests ==="
          python -m pytest test_weather.py -v || python test_weather.py
          
      - name: ğŸ“Š Show main code
        run: |
          echo "=== Main Weather App Code ==="
          cat python-weather-app/weather_app.py
          
      - name: ğŸ’¾ Commit created project
        run: |
          git config user.name "Claude AI Bot"
          git config user.email "claude@anthropic.com"
          
          git add python-weather-app/
          git commit -m "ğŸ Add Python weather app created by Claude AI
          
          - Weather API integration
          - Unit tests included
          - Complete documentation
          
          Generated by Claude Code Action" || echo "No changes to commit"
          
          git push origin main || echo "Push failed or no changes"
          
      - name: ğŸ“ Summary
        if: always()
        run: |
          echo "## ğŸ‰ Python Project Creation Summary"
          echo ""
          echo "**Status**: ${{ steps.claude-python.outputs.conclusion }}"
          echo "**Execution Log**: ${{ steps.claude-python.outputs.execution_file }}"
          echo ""
          if [ -d "python-weather-app" ]; then
            echo "âœ… Project created successfully!"
            echo "Files created: $(find python-weather-app -type f | wc -l)"
          else
            echo "âŒ Project creation failed"
          fi
          
      - name: Upload execution log
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: claude-python-log
          path: ${{ steps.claude-python.outputs.execution_file }}
          retention-days: 7